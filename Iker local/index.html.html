<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>El Peque√±o Explorador</title>
    
    <!-- √çcono para el iPad y navegadores -->
    <link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48Y2lyY2xlIGN4PSI1MCIgY3k9IjUwIiByPSI0NSIgZmlsbD0iI2Y1OWUwYiIvPjxjaXJjbGUgY3g9IjI1IiBjeT0iMjUiIHI9IjEwIiBmaWxsPSIjZDk3NzA2Ii8+PGNpcmNsZSBjeD0iNzUiIGN5PSIyNSIgcj0iMTAiIGZpbGw9IiNkOTc3MDYiLz48Y2lyY2xlIGN4PSIzNSIgY3k9IjUwIiByPSI1IiBmaWxsPSIjMmMyYzJjIi8+PGNpcmNsZSBjeD0iNjUiIGN5PSI1MCIgcj0iNSIgZmlsbD0iIzJjMmMyYyIvPjxwYXRoIGQ9Ik0gNDAgNzAgcSAxMCAxMCAyMCAwIiBzdHJva2U9IiMyYzJjMmMiIHN0cm9rZS1widthPSIzIiBmaWxsPSJub25lIiBzdHJva2UtbGluZWNhcD0icm91bmQiLz48cGF0aCBkPSJNIDUwIDYwIHYgMTAiIHN0cm9rZT0iIzJjMmMyYyIgc3Ryb2tlLXdpZHRoPSIzIiBmaWxsPSJub25lIiBzdHJva2UtbGluZWNhcD0icm91bmQiLz48L3N2Zz4=">
    <link rel="icon" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48Y2lyY2xlIGN4PSI1MCIgY3k9IjUwIiByPSI0NSIgZmlsbD0iI2Y1OWUwYiIvPjxjaXJjbGUgY3g9IjI1IiBjeT0iMjUiIHI9IjEwIiBmaWxsPSIjZDk3NzA2Ii8+PGNpcmNsZSBjeD0iNzUiIGN5PSIyNSIgcj0iMTAiIGZpbGw9IiNkOTc3MDYiLz48Y2lyY2xlIGN4PSIzNSIgY3k9IjUwIiByPSI1IiBmaWxsPSIjMmMyYzJjIi8+PGNpcmNsZSBjeD0iNjUiIGN5PSI1MCIgcj0iNSIgZmlsbD0iIzJjMmMyYyIvPjxwYXRoIGQ9Ik0gNDAgNzAgcSAxMCAxMCAyMCAwIiBzdHJva2U9IiMyYzJjMmMiIHN0cm9rZS1widthPSIzIiBmaWxsPSJub25lIiBzdHJva2UtbGluZWNhcD0icm91bmQiLz48cGF0aCBkPSJNIDUwIDYwIHYgMTAiIHN0cm9rZT0iIzJjMmMyYyIgc3Ryb2tlLXdpZHRoPSIzIiBmaWxsPSJub25lIiBzdHJva2UtbGluZWNhcD0icm91bmQiLz48L3N2Zz4=">

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f0f9ff;
        }
        h1, h2, h3 {
            font-family: 'Fredoka One', cursive;
        }
        .screen { display: none; }
        .active-screen { display: block; }
        .main-button {
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .main-button:hover:not(:disabled) {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .quiz-option {
            transition: all 0.2s ease-in-out;
        }
        .quiz-option:hover:not([disabled]) {
            transform: scale(1.05);
            background-color: #fef08a;
        }
        .quiz-option.selected {
            border-color: #3b82f6; /* blue-500 */
            background-color: #bfdbfe; /* blue-200 */
        }
        .quiz-option.correct { background-color: #86efac; border-color: #22c55e; }
        .quiz-option.incorrect { background-color: #fca5a5; border-color: #ef4444; }
        .progress-bar-inner { transition: width 0.5s ease-in-out; }
        .speak-btn {
            background-color: #3b82f6; color: white; border-radius: 50%; width: 40px; height: 40px;
            display: flex; align-items: center; justify-content: center; flex-shrink: 0;
            transition: background-color 0.2s;
        }
        .speak-btn:hover { background-color: #2563eb; }
        .locked-overlay {
            position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            background-color: rgba(107, 114, 128, 0.7);
            display: flex; align-items: center; justify-content: center;
            border-radius: 1rem;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 50;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.5);
            align-items: center;
            justify-content: center;
        }
        .modal.flex { display: flex; }
    </style>
</head>
<body class="text-gray-800">

    <div id="app-container" class="max-w-4xl mx-auto p-4 md:p-8">

        <!-- Pantalla de Bienvenida -->
        <div id="welcome-screen" class="screen active-screen text-center">
             <div class="flex justify-center mb-4">
                 <svg class="w-40 h-40" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
                    <g transform="translate(100 100)">
                        <path d="M51.9,-41.7C65.3,-26.1,72.7,-2.1,69.2,20.1C65.7,42.4,51.3,62.8,32,70.1C12.7,77.4,-11.5,71.6,-32.1,60.5C-52.7,49.4,-69.7,33,-75.2,12.7C-80.7,-7.6,-74.6,-31.8,-60.7,-46.8C-46.8,-61.8,-24.9,-67.7,-3.9,-65.8C17.1,-63.9,38.4,-57.2,51.9,-41.7Z" fill="#f59e0b" transform="scale(1.1)"></path>
                        <circle cx="-18" cy="-22" r="8" fill="#2c2c2c"></circle>
                        <circle cx="18" cy="-22" r="8" fill="#2c2c2c"></circle>
                        <path d="M -20 8 C -15 20, 15 20, 20 8" stroke="#2c2c2c" stroke-width="5" fill="none" stroke-linecap="round"></path>
                        <path d="M 0 -5 C 0 -12, -3 -15, -7 -15 C -11 -15, -14 -12, -14 -5" fill="#4a2c0a"></path>
                    </g>
                 </svg>
            </div>
            <h1 class="text-4xl md:text-6xl text-blue-600 mb-4">El Peque√±o Explorador</h1>
            <h2 class="text-xl md:text-2xl text-amber-600 mb-8">Aventura de Aprendizaje</h2>
            <button id="daily-reading-btn" class="main-button w-full mb-8 bg-purple-500 text-white py-4 px-6 rounded-2xl text-2xl shadow-lg hover:bg-purple-600">
                üìñ Lectura del D√≠a
            </button>
            <p class="text-lg md:text-xl text-gray-600 mb-8">¬°Hola! Soy Leo. ¬°Vamos a aprender juntos, bloque por bloque!</p>
            <div id="blocks-container" class="grid grid-cols-2 md:grid-cols-4 gap-4 md:gap-6">
                <!-- Los bloques se generar√°n aqu√≠ -->
            </div>
        </div>

        <!-- Pantalla de Temas del Bloque -->
        <div id="block-view-screen" class="screen">
            <button onclick="renderWelcomeScreen()" class="mb-6 bg-amber-500 text-white py-2 px-4 rounded-lg shadow hover:bg-amber-600 transition">‚Üê Volver a los Bloques</button>
            <h1 id="block-title" class="text-3xl md:text-5xl text-blue-600 mb-2 text-center"></h1>
            <p id="daily-message" class="text-center text-lg text-gray-600 mb-8"></p>
            <div id="topics-container" class="grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6">
                <!-- Los temas se generar√°n aqu√≠ -->
            </div>
             <div id="quiz-button-container" class="mt-8 text-center hidden">
                <button id="start-block-quiz-btn" class="main-button bg-green-500 text-white text-xl font-bold py-4 px-8 rounded-full shadow-lg hover:bg-green-600">
                    ¬°Evaluaci√≥n Final del Bloque!
                </button>
            </div>
        </div>

        <!-- Pantalla de Lecci√≥n -->
        <div id="lesson-screen" class="screen">
            <div class="bg-white p-6 md:p-8 rounded-2xl shadow-lg">
                <h2 id="lesson-title" class="text-2xl md:text-4xl text-blue-600 mb-6"></h2>
                <div id="lesson-content" class="text-lg md:text-xl space-y-6"></div>
                <div id="lesson-navigation" class="mt-8 flex justify-between items-center">
                    <button id="prev-step-btn" class="main-button bg-gray-300 py-2 px-5 rounded-lg hover:bg-gray-400">Anterior</button>
                    <div id="step-counter" class="text-gray-500"></div>
                    <button id="next-step-btn" class="main-button bg-blue-500 text-white py-2 px-5 rounded-lg hover:bg-blue-600">Siguiente</button>
                </div>
            </div>
        </div>
        
        <!-- Pantalla de Cuestionario (de Lecci√≥n y Final) -->
        <div id="quiz-screen" class="screen">
             <h1 id="quiz-main-title" class="text-3xl md:text-5xl text-center text-green-600 mb-2"></h1>
             <p id="quiz-topic-title" class="text-center text-lg text-gray-500 mb-4"></p>
             <div class="w-full bg-gray-200 rounded-full h-4 mb-6">
                <div id="quiz-progress-bar" class="bg-green-500 h-4 rounded-full progress-bar-inner" style="width: 0%"></div>
            </div>
            <div class="bg-white p-6 md:p-10 rounded-2xl shadow-lg text-center">
                <div id="quiz-question-container" class="flex items-center justify-center gap-x-4">
                    <p id="quiz-question" class="text-xl md:text-3xl mb-8 min-h-[80px]"></p>
                </div>
                <div id="quiz-image-container" class="flex justify-center mb-6 w-full max-w-sm mx-auto"></div>
                <div id="quiz-options" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
                <button id="quiz-next-btn" class="hidden mt-8 main-button bg-blue-500 text-white text-lg font-bold py-3 px-8 rounded-full hover:bg-blue-600">Siguiente Pregunta</button>
            </div>
        </div>

        <!-- Pantalla de Lectura Diaria -->
        <div id="reading-screen" class="screen">
            <button onclick="renderWelcomeScreen()" class="mb-6 bg-purple-500 text-white py-2 px-4 rounded-lg shadow hover:bg-purple-600 transition">‚Üê Volver al Inicio</button>
            <div id="reading-content-wrapper">
                <h1 class="text-3xl md:text-5xl text-purple-600 mb-4 text-center">Lectura del D√≠a</h1>
                <div class="bg-white p-6 md:p-8 rounded-2xl shadow-lg">
                    <h2 id="reading-title" class="text-2xl md:text-3xl text-purple-800 mb-4"></h2>
                    <div id="reading-image" class="mb-4"></div>
                    <div class="flex items-start gap-x-4">
                        <p id="reading-text" class="text-xl md:text-2xl leading-relaxed flex-grow"></p>
                    </div>
                    <button id="start-reading-quiz-btn" class="mt-8 w-full main-button bg-green-500 text-white text-lg font-bold py-3 px-8 rounded-full hover:bg-green-600">¬°Comprobar lectura!</button>
                </div>
            </div>
            <div id="reading-unavailable" class="text-center hidden">
                 <h1 class="text-3xl md:text-5xl text-purple-600 mb-4">¬°Genial!</h1>
                 <p class="text-xl text-gray-700">Ya completaste la lectura de hoy. Vuelve ma√±ana para descubrir una nueva historia.</p>
            </div>
        </div>

        <!-- Pantallas de Resultados y Proyectos -->
        <div id="results-screen" class="screen text-center">
            <h1 class="text-4xl md:text-6xl text-amber-500 mb-4">¬°Excelente Trabajo!</h1>
            <p class="text-xl md:text-2xl mb-6">Has completado el cuestionario del <span id="results-block-name" class="font-bold"></span>.</p>
            <div class="bg-white rounded-2xl shadow-lg p-8 inline-block mb-8">
                <p class="text-lg">Tu puntuaci√≥n:</p>
                <p id="final-score" class="text-6xl font-bold text-green-500"></p>
                <p id="final-message" class="mt-4 text-lg"></p>
            </div>
            <div class="flex flex-col md:flex-row justify-center gap-4">
                 <button id="show-projects-btn" class="main-button bg-purple-500 text-white text-lg font-bold py-3 px-6 rounded-full hover:bg-purple-600">Ver Proyecto del Bloque</button>
                 <button onclick="renderWelcomeScreen()" class="main-button bg-amber-500 text-white text-lg font-bold py-3 px-6 rounded-full hover:bg-amber-600">Volver al Inicio</button>
            </div>
        </div>
        <div id="projects-screen" class="screen">
            <button id="back-to-results" class="mb-6 bg-amber-500 text-white py-2 px-4 rounded-lg shadow hover:bg-amber-600 transition">‚Üê Volver a Resultados</button>
            <h1 class="text-3xl md:text-5xl text-purple-600 mb-6 text-center">Proyecto y Actividades</h1>
            <div class="bg-white p-6 md:p-8 rounded-2xl shadow-lg">
                <h2 id="project-title" class="text-2xl md:text-3xl text-purple-500 mb-4"></h2>
                <p id="project-description" class="text-lg mb-4"></p>
                <h3 class="font-bold text-xl mb-2">Materiales que necesitar√°s:</h3>
                <ul id="project-materials" class="list-disc list-inside text-lg"></ul>
            </div>
        </div>
        
        <!-- Modales -->
        <div id="activity-modal" class="modal">
             <div class="bg-white p-8 rounded-2xl shadow-2xl text-center max-w-sm mx-4">
                <div class="text-6xl mb-4">üñêÔ∏è</div>
                <h2 class="text-2xl font-bold text-purple-600 mb-2">¬°Manos a la Obra!</h2>
                <p id="activity-modal-text" class="text-gray-700 mb-6"></p>
                <button id="activity-confirm-btn" class="w-full bg-green-500 text-white py-3 px-6 rounded-full hover:bg-green-600 text-lg font-bold">¬°Listo, la termin√©!</button>
            </div>
        </div>
    </div>

    <script>
    // --- DATABASE & STATE ---
    const DB_NAME = 'pequenoExploradorProgress_v3'; // Increased version to avoid conflicts
    const createSVG = (bgColor, textColor, textContent, width = 400, height = 200) => {
        return `<svg class="rounded-lg" viewBox="0 0 ${width} ${height}" xmlns="http://www.w3.org/2000/svg">
            <rect width="${width}" height="${height}" fill="${bgColor}" rx="10"></rect>
            <text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" font-size="${height / 2.5}" fill="${textColor}" font-family="Fredoka One, cursive">${textContent}</text>
        </svg>`;
    };
    
     const learningData = [
        {
            block: 1, title: "Iniciando la Aventura", colors: { bg: 'bg-green-400', hover: 'hover:bg-green-500' },
            topics: [
                {
                    id: 'b1-mates-1', subject: 'Mates', title: 'Contar Objetos', icon: 'üî¢',
                    content: [
                        { type: 'explanation', text: '¬°Hola! Hoy aprenderemos el superpoder de contar. Contar nos ayuda a saber "cu√°ntos hay". ¬°Podemos contar juguetes, galletas, estrellas y todo lo que imagines!' },
                        { type: 'explanation', text: 'La regla m√°s importante es dar a cada objeto un solo n√∫mero y siempre en el mismo orden: uno, dos, tres, cuatro, y as√≠. ¬°Nunca te saltes un n√∫mero ni cuentes el mismo objeto dos veces!' },
                        { type: 'example', text: 'Miremos estas manzanas. Toco la primera y digo "uno". Toco la segunda y digo "dos". ¬°Hay 2 manzanas!', image: createSVG('#fca5a5', '#dc2626', 'üçéüçé') },
                        { type: 'example', text: 'Ahora con estos coches. Uno... dos... tres... ¬°y cuatro! Tenemos 4 coches. ¬øVes qu√© f√°cil es?', image: createSVG('#93c5fd', '#1e40af', 'üöóüöóüöóüöó') },
                        { type: 'interactive', text: '¬°Es tu turno! Conc√©ntrate y cuenta con cuidado cu√°ntos barcos hay en la imagen. ¬°T√∫ puedes!', image: createSVG('#a5f3fc', '#0e7490', '‚õµÔ∏è‚õµÔ∏è‚õµÔ∏è‚õµÔ∏è‚õµÔ∏è') },
                        { type: 'explanation', text: '¬°Fant√°stico! Hay 5 barcos. Ya eres un experto contando. Practicar este superpoder te ayudar√° a ser genial con los n√∫meros.' },
                    ],
                    lessonQuiz: [
                        { prompt: '¬øCu√°ntos tri√°ngulos ves?', image: createSVG('#a7f3d0', '#047857', '‚ñ≤‚ñ≤‚ñ≤‚ñ≤'), options: ['3', '5', '4'], answer: '4' },
                        { prompt: '¬øCu√°ntos c√≠rculos hay?', image: createSVG('#bfdbfe', '#1d4ed8', '‚óè‚óè'), options: ['2', '1', '3'], answer: '2' },
                        { prompt: 'Cuenta las estrellas.', image: createSVG('#fef9c3', '#ca8a04', '‚òÖ ‚òÖ ‚òÖ ‚òÖ ‚òÖ'), options: ['4', '5', '6'], answer: '5' },
                        { prompt: '¬øCu√°ntos cuadrados hay aqu√≠?', image: createSVG('#e9d5ff', '#7e22ce', '‚ñ†'), options: ['1', '2', '0'], answer: '1' },
                        { prompt: 'Elige el n√∫mero correcto de flores.', image: createSVG('#fce7f3', '#db2777', 'üå∏üå∏üå∏'), options: ['2', '4', '3'], answer: '3' },
                    ],
                    activity: 'Busca 5 objetos de color rojo en tu casa y ponlos juntos. ¬°Cu√©ntalos en voz alta!',
                    quiz: [
                        { prompt: '¬øCu√°ntas manzanas hay?', image: createSVG('#fca5a5', '#dc2626', 'üçéüçé', 300, 150), options: ['1', '3', '2'], answer: '2' },
                        { prompt: 'Cuenta los corazones.', image: createSVG('#fbcfe8', '#ec4899', '‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è', 300, 150), options: ['3', '4', '5'], answer: '4' },
                    ]
                },
                {
                    id: 'b1-espanol-1', subject: 'Espa√±ol', title: 'El Abecedario', icon: 'üî§',
                    content: [
                        { type: 'explanation', text: '¬°Vamos a conocer al equipo de las letras: el abecedario! Las letras son los dibujos que usamos para escribir las palabras que decimos. Cada una tiene un nombre y un sonido.' },
                        { type: 'explanation', text: 'Hay dos tipos de letras: las vocales (A, E, I, O, U) que suenan fuerte y solas, y las consonantes, que necesitan una vocal para sonar bien.' },
                        { type: 'example', text: 'Por ejemplo, la letra "M" suena "mmm". Si la juntamos con la vocal "A", que suena "aah", ¬°formamos la s√≠laba "ma"!', image: createSVG('#d1fae5', '#047857', 'M + A = MA') },
                        { type: 'example', text: 'Lo mismo pasa con la "P". Su sonido es como una peque√±a explosi√≥n: "p". Si la unes con la "A", suena "pa". ¬°Con "ma" y "pa" podemos escribir "mapa"!', image: createSVG('#e0e7ff', '#3730a3', 'PA + PA = PAP√Å') },
                        { type: 'interactive', text: 'Ahora, un peque√±o reto. La letra "L" suena "llll". Si la juntamos con la "O", ¬øc√≥mo crees que sonar√°?', image: createSVG('#fef3c7', '#b45309', 'L + O = ?') },
                        { type: 'explanation', text: '¬°Suena "lo"! ¬°Muy bien! Aprender los sonidos de cada letra y c√≥mo se unen es el secreto para aprender a leer. ¬°Poco a poco los conocer√°s a todos!' },
                    ],
                    lessonQuiz: [
                        { prompt: '¬øQu√© letra empieza la palabra "√°rbol"?', image: createSVG('#bbf7d0', '#166534', 'üå≥'), options: ['O', 'A', 'E'], answer: 'A' },
                        { prompt: '¬øQu√© letra va despu√©s de la "B"?', options: ['A', 'C', 'D'], answer: 'C' },
                        { prompt: 'Elige la letra con la que empieza "mam√°".', image: createSVG('#fbcfe8', '#9d174d', '‚ù§Ô∏è'), options: ['P', 'S', 'M'], answer: 'M' },
                        { prompt: '¬øCon qu√© letra termina "sol"?', image: createSVG('#fef08a', '#b45309', '‚òÄÔ∏è'), options: ['S', 'O', 'L'], answer: 'L' },
                        { prompt: 'La palabra "dedo" empieza con la letra...', image: createSVG('#e0e7ff', '#3730a3', 'üëÜ'), options: ['B', 'D', 'P'], answer: 'D' },
                    ],
                    activity: 'Busca en un libro o revista la primera letra de tu nombre. ¬°Intenta encontrar cinco!',
                    quiz: [
                        { prompt: '¬øQu√© letra va despu√©s de la C?', options: ['B', 'D', 'E'], answer: 'D' },
                        { prompt: 'La palabra "gato" empieza con la letra...', image: createSVG('#d1d5db', '#4b5563', 'Gato üêà', 300, 150), options: ['G', 'P', 'T'], answer: 'G' },
                    ]
                },
                 {
                    id: 'b1-ciencias-1', subject: 'Ciencias', title: 'Partes del Cuerpo', icon: 'üèÉ',
                    content: [
                         { type: 'explanation', text: '¬°Vamos a explorar la m√°quina m√°s perfecta que existe: tu cuerpo! Hoy conoceremos las partes que podemos ver por fuera, que se llaman partes externas.' },
                         { type: 'explanation', text: 'Empecemos por arriba. Tu cabeza es el centro de control. Ah√≠ tienes los ojos para ver colores y formas, y la boca para sonre√≠r y saborear la comida.' },
                         { type: 'example', text: 'Tambi√©n en la cabeza est√°n la nariz, que te permite oler desde una flor hasta la pizza, y las orejas, ¬°con las que escuchas los cuentos que te cuentan!', image: createSVG('#ede9fe', '#6d28d9', 'üëÄ üëÉ üëÑ üëÇ') },
                         { type: 'explanation', text: 'Luego est√° el tronco, que es el centro de tu cuerpo. ¬°Es como el tallo de una flor! Conecta tu cabeza con tus brazos y piernas.' },
                         { type: 'example', text: 'Y finalmente, ¬°las extremidades! Tus brazos y manos te sirven para abrazar y dibujar. Y tus piernas y pies son geniales para correr, saltar y bailar.', image: createSVG('#fce7f3', '#db2777', 'üí™ ü¶µ') },
                         { type: 'interactive', text: 'Ahora dime, si quieres oler una sopa deliciosa, ¬øqu√© parte de tu cuerpo usas principalmente?', image: createSVG('#e0f2fe', '#0ea5e9', 'üç≤') },
                         { type: 'explanation', text: '¬°La nariz, por supuesto! Cada parte de tu cuerpo tiene un trabajo especial, y todas juntas te permiten jugar, aprender y descubrir el mundo.' },
                    ],
                    lessonQuiz: [
                        { prompt: '¬øQu√© parte usas para oler una flor?', image: createSVG('#fef2f2', '#ef4444', 'üëÉ üå∏'), options: ['Ojos', 'Boca', 'Nariz'], answer: 'Nariz' },
                        { prompt: 'Usamos las ____ para aplaudir.', options: ['Manos', 'Pies', 'Rodillas'], answer: 'Manos' },
                        { prompt: '¬øD√≥nde est√° tu cabello?', options: ['En los pies', 'En la cabeza', 'En la espalda'], answer: 'En la cabeza' },
                        { prompt: '¬øQu√© parte usas para escuchar m√∫sica?', image: createSVG('#dbeafe', '#312e81', 'üëÇüé∂'), options: ['Orejas', 'Ojos', 'Nariz'], answer: 'Orejas' },
                        { prompt: 'Si quieres patear una pelota, usas tus...', image: createSVG('#e0e7ff', '#4338ca', '‚öΩÔ∏è'), options: ['Manos', 'Pies', 'Brazos'], answer: 'Pies' },
                    ],
                    activity: '¬°Vamos a jugar "Sim√≥n dice"! Pide a alguien que juegue contigo a tocarse las partes del cuerpo.',
                    quiz: [
                        { prompt: '¬øD√≥nde te pones los zapatos?', image: createSVG('#e0f2fe', '#0ea5e9', 'üëü‚û°Ô∏è‚ùì', 300, 150), options: ['En las manos', 'En la cabeza', 'En los pies'], answer: 'En los pies' },
                        { prompt: 'Usamos las ____ para correr y saltar.', options: ['piernas', 'brazos', 'orejas'], answer: 'piernas' },
                    ]
                },
            ],
            project: {
                title: 'Proyecto: Mi Caja de Tesoros',
                description: '¬°Vamos a crear una caja para guardar tus cosas favoritas y aprender al mismo tiempo! Primero, decora una caja de zapatos con tus colores preferidos. Luego, escribe una etiqueta grande con tu nombre para pegarla en la caja (¬°as√≠ practicamos Espa√±ol!). Despu√©s, busca 10 de tus juguetes peque√±os favoritos y m√©telos en la caja. Cu√©ntalos uno por uno en voz alta (¬°eso es Mates!). Finalmente, dibuja en un papel las partes de tu cuerpo que usaste para hacer todo: tus manos para decorar, tus ojos para ver los colores y tus piernas para buscar los juguetes (¬°y eso es Ciencias!).',
                materials: ['Caja de zapatos', 'Colores, pintura o plumones', 'Papel', 'Tijeras (con ayuda de un adulto)', 'Pegamento', 'Tus juguetes favoritos']
            }
        },
        ...[2,3,4,5,6,7,8].map(i => ({ block: i, title: `Bloque ${i}`, colors: { bg: 'bg-gray-400', hover: 'hover:bg-gray-500' }, topics: [], project: null })),
    ];

    const dailyReadings = [
        { id: 'r1', title: 'El Sol y la Luna', text: 'El Sol sale de d√≠a. La Luna sale de noche. El Sol es amarillo y brillante. La Luna es blanca y redonda. Juegan a las escondidas en el cielo.', image: createSVG('#f3f4f6', '#1f2937', '‚òÄÔ∏è üåô'), 
          quiz: [ { prompt: '¬øQui√©n sale de d√≠a?', options: ['La Luna', 'El Sol', 'Una estrella'], answer: 'El Sol' }]
        },
        { id: 'r2', title: 'Mi Perro Tito', text: 'Tengo un perro llamado Tito. Tito es de color caf√©. Le gusta correr en el parque. Mueve la cola cuando est√° feliz. Tito es mi mejor amigo.', image: createSVG('#fef2f2', '#b91c1c', 'üê∂ ‚ù§Ô∏è'),
          quiz: [ { prompt: '¬øDe qu√© color es Tito?', options: ['Negro', 'Blanco', 'Caf√©'], answer: 'Caf√©' }]
        },
    ];

    let appState = {
        currentScreen: 'welcome-screen',
        currentBlock: null,
        currentTopicId: null,
        currentStep: 0,
        quizState: {},
        currentReading: null,
        quizContext: null, // 'lesson', 'reading', or 'block'
    };
    let progress = {
        unlockedBlock: 1,
        completedTopics: [],
        lessonsCompletedToday: { date: null, count: 0 },
        completedReadings: [],
        lastReadingDate: null
    };
    
    // --- PROGRESS MANAGEMENT ---
    function saveProgress() { localStorage.setItem(DB_NAME, JSON.stringify(progress)); }
    function loadProgress() {
        const saved = localStorage.getItem(DB_NAME);
        if (saved) {
            const savedProgress = JSON.parse(saved);
            progress = { ...progress, ...savedProgress };
            if (savedProgress.lessonsCompletedToday) {
                 progress.lessonsCompletedToday = savedProgress.lessonsCompletedToday;
            }
        }
    }

    function canStartNewLesson() {
        const today = new Date().toISOString().slice(0, 10);
        if (progress.lessonsCompletedToday.date !== today) {
            progress.lessonsCompletedToday = { date: today, count: 0 };
        }
        return progress.lessonsCompletedToday.count < 3;
    }

    function canStartNewReading() {
        const today = new Date().toISOString().slice(0, 10);
        return progress.lastReadingDate !== today;
    }
    
    function markTopicAsCompleted(topicId) {
        if (!progress.completedTopics.includes(topicId)) {
            progress.completedTopics.push(topicId);
            saveProgress();
        }
    }

    function checkAndUnlockNextBlock() {
        const blockData = learningData.find(b => b.block === appState.currentBlock);
        if (!blockData || !blockData.topics) return;
        const allTopicsInBlock = blockData.topics.map(t => t.id);
        const allTopicsCompleted = allTopicsInBlock.every(id => progress.completedTopics.includes(id));

        if (allTopicsCompleted && progress.unlockedBlock === appState.currentBlock) {
            progress.unlockedBlock++;
            saveProgress();
        }
    }

    // --- SPEECH & NAVIGATION ---
    let mexicoVoice = null;
    function loadVoices() {
        const voices = speechSynthesis.getVoices();
        mexicoVoice = voices.find(v => v.lang === 'es-MX' && v.name.includes('Google') || v.lang === 'es-US') || voices.find(v => v.lang.startsWith('es-'));
    }
    speechSynthesis.onvoiceschanged = loadVoices;

    function stopSpeaking() {
        if (speechSynthesis.speaking) {
            speechSynthesis.cancel();
        }
    }

    function speakText(text) {
        stopSpeaking();
        try {
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'es-MX';
            utterance.rate = 1.15;
            if (mexicoVoice) utterance.voice = mexicoVoice;
            speechSynthesis.speak(utterance);
        } catch (error) { console.error("Error en la s√≠ntesis de voz:", error); }
    }
    
    function navigateTo(screenId) {
        stopSpeaking();
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active-screen'));
        document.getElementById(screenId).classList.add('active-screen');
        appState.currentScreen = screenId;
        window.scrollTo(0, 0);
    }

    // --- RENDER FUNCTIONS ---
    function renderWelcomeScreen() {
        document.getElementById('daily-reading-btn').onclick = showDailyReading;
        const container = document.getElementById('blocks-container');
        container.innerHTML = '';
        learningData.forEach(blockData => {
            const isLocked = blockData.block > progress.unlockedBlock;
            const button = document.createElement('button');
            button.className = `main-button p-4 md:p-6 rounded-2xl text-white font-bold text-lg md:text-xl shadow-lg flex flex-col items-center justify-center aspect-square relative ${isLocked ? 'bg-gray-500 cursor-not-allowed' : blockData.colors.bg + ' ' + blockData.colors.hover}`;
            button.innerHTML = `<span>Bloque ${blockData.block}</span><span class="text-sm font-normal text-center">${blockData.title}</span>`;
            button.disabled = isLocked;
            button.onclick = () => showBlockView(blockData.block);

            if (isLocked) {
                button.innerHTML += `<div class="locked-overlay">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-white" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 1a4.5 4.5 0 00-4.5 4.5V9H5a2 2 0 00-2 2v6a2 2 0 002 2h10a2 2 0 002-2v-6a2 2 0 00-2-2h-.5V5.5A4.5 4.5 0 0010 1zm3 8V5.5a3 3 0 10-6 0V9h6z" clip-rule="evenodd" /></svg>
                </div>`;
            }
            container.appendChild(button);
        });
        navigateTo('welcome-screen');
    }

    function showBlockView(blockId) {
        appState.currentBlock = blockId;
        const blockData = learningData.find(b => b.block === blockId);
        document.getElementById('block-title').textContent = `Bloque ${blockData.block}: ${blockData.title}`;
        
        const lessonStatus = canStartNewLesson();
        const lessonsDoneToday = progress.lessonsCompletedToday.date === new Date().toISOString().slice(0, 10) ? progress.lessonsCompletedToday.count : 0;
        document.getElementById('daily-message').textContent = lessonStatus
            ? `¬°Elige tu lecci√≥n! Puedes hacer ${3 - lessonsDoneToday} m√°s hoy.`
            : '¬°Gran trabajo hoy! Has completado tus 3 lecciones. Vuelve ma√±ana.';

        const container = document.getElementById('topics-container');
        container.innerHTML = '';
        let completedInBlock = 0;
        
        blockData.topics.forEach(topic => {
            const isCompleted = progress.completedTopics.includes(topic.id);
            if(isCompleted) completedInBlock++;

            const canBeStarted = lessonStatus || isCompleted;
            const isLockedToday = !canBeStarted;

            const button = document.createElement('button');
            button.className = `p-4 rounded-xl shadow text-left flex items-center space-x-4 transition relative ${isLockedToday && !isCompleted ? 'bg-gray-200 cursor-not-allowed' : 'bg-white cursor-pointer transform hover:scale-105'}`;
            button.disabled = isLockedToday && !isCompleted;
            button.onclick = () => showLesson(topic.id);

            let subjectColor = 'text-blue-500';
            if (topic.subject === 'Espa√±ol') subjectColor = 'text-green-500';
            if (topic.subject === 'Ciencias') subjectColor = 'text-amber-500';

            button.innerHTML = `
                <div class="text-4xl">${topic.icon}</div>
                <div class="flex-grow">
                    <p class="font-bold text-lg">${topic.title}</p>
                    <p class="text-sm ${subjectColor}">${topic.subject}</p>
                </div>
                ${isCompleted ? '<div class="text-3xl text-green-500">‚úÖ</div>' : ''}
            `;
            if (isLockedToday && !isCompleted) {
                 button.innerHTML += `<div class="locked-overlay" style="background-color: rgba(229, 231, 235, 0.8);">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                </div>`;
            }
            container.appendChild(button);
        });

        if (completedInBlock === blockData.topics.length && blockData.topics.length > 0) {
            document.getElementById('quiz-button-container').classList.remove('hidden');
        } else {
            document.getElementById('quiz-button-container').classList.add('hidden');
        }

        navigateTo('block-view-screen');
    }

    function showLesson(topicId) {
        if (!progress.completedTopics.includes(topicId) && !canStartNewLesson()) return;
        appState.currentTopicId = topicId;
        appState.currentStep = 0;
        renderLessonStep();
        navigateTo('lesson-screen');
    }

    function renderLessonStep() {
        const blockData = learningData.find(b => b.block === appState.currentBlock);
        if (!blockData) return;
        const topicData = blockData.topics.find(t => t.id === appState.currentTopicId);
        if (!topicData) return;
        const stepData = topicData.content[appState.currentStep];
        
        document.getElementById('lesson-title').textContent = `${topicData.icon} ${topicData.title}`;
        const contentEl = document.getElementById('lesson-content');
        contentEl.innerHTML = '';
        
        const speakButton = `<button onclick="speakText(\`${(stepData.text || '').replace(/`/g, "'")}\`)" class="speak-btn">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" /></svg>
        </button>`;

        let html = `<div class="flex items-start gap-x-4">
            <svg class="w-16 h-16 flex-shrink-0" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg"><g transform="translate(100 100)"><path d="M51.9,-41.7C65.3,-26.1,72.7,-2.1,69.2,20.1C65.7,42.4,51.3,62.8,32,70.1C12.7,77.4,-11.5,71.6,-32.1,60.5C-52.7,49.4,-69.7,33,-75.2,12.7C-80.7,-7.6,-74.6,-31.8,-60.7,-46.8C-46.8,-61.8,-24.9,-67.7,-3.9,-65.8C17.1,-63.9,38.4,-57.2,51.9,-41.7Z" fill="#f59e0b"></path><circle cx="-15" cy="-20" r="5" fill="#2c2c2c"></circle><circle cx="15" cy="-20" r="5" fill="#2c2c2c"></circle><path d="M -15 5 C -10 15, 10 15, 15 5" stroke="#2c2c2c" stroke-width="4" fill="none" stroke-linecap="round"></path><path d="M 0 -2 C 0 -8, -2 -10, -5 -10 C -8 -10, -10 -8, -10 -2" fill="#4a2c0a"></path></g></svg>
            <div class="flex items-center gap-x-3 w-full">
                 <p class="bg-amber-100 p-3 rounded-lg flex-grow">${stepData.text}</p>
                 ${speakButton}
            </div>
        </div>`;
        
        if (stepData.image) {
            html += `<div class="mt-4 w-full max-w-md mx-auto">${stepData.image}</div>`;
        }
       
        contentEl.innerHTML = html;

        document.getElementById('step-counter').textContent = `Paso ${appState.currentStep + 1} de ${topicData.content.length}`;
        document.getElementById('prev-step-btn').disabled = appState.currentStep === 0;

        const isLastStep = appState.currentStep === topicData.content.length - 1;
        const nextButton = document.getElementById('next-step-btn');
        
        if (isLastStep) {
            nextButton.textContent = 'Evaluar Lecci√≥n';
            nextButton.onclick = () => startLessonQuiz(appState.currentTopicId);
        } else {
            nextButton.textContent = 'Siguiente';
            nextButton.onclick = () => { appState.currentStep++; renderLessonStep(); };
        }
        
        if (stepData.text) {
            setTimeout(() => {
                speakText(stepData.text);
            }, 100);
        }
    }

    // --- READING, QUIZ, and RETRY LOGIC ---
    function showDailyReading() {
        if (canStartNewReading()) {
            const nextReading = dailyReadings.find(r => !progress.completedReadings.includes(r.id));
            if (nextReading) {
                appState.currentReading = nextReading;
                document.getElementById('reading-title').textContent = nextReading.title;
                document.getElementById('reading-text').textContent = nextReading.text;
                document.getElementById('reading-image').innerHTML = `<div class="w-full max-w-md mx-auto">${nextReading.image}</div>`;
                document.getElementById('start-reading-quiz-btn').onclick = () => startReadingQuiz(nextReading);
                document.getElementById('reading-content-wrapper').classList.remove('hidden');
                document.getElementById('reading-unavailable').classList.add('hidden');
            } else {
                document.getElementById('reading-content-wrapper').classList.add('hidden');
                document.getElementById('reading-unavailable').classList.remove('hidden');
                document.getElementById('reading-unavailable').querySelector('p').textContent = "¬°Has completado todas las lecturas disponibles. ¬°Felicidades!";
            }
        } else {
            document.getElementById('reading-content-wrapper').classList.add('hidden');
            document.getElementById('reading-unavailable').classList.remove('hidden');
        }
        navigateTo('reading-screen');
    }

    function startLessonQuiz(topicId) {
        const topic = learningData.find(b => b.block === appState.currentBlock).topics.find(t => t.id === topicId);
        appState.quizContext = 'lesson';
        startQuiz(topic.lessonQuiz, `Evaluaci√≥n: ${topic.title}`);
    }

    function startReadingQuiz(reading) {
        appState.quizContext = 'reading';
        startQuiz(reading.quiz, `Comprensi√≥n: ${reading.title}`);
    }

    function startBlockQuiz() {
        const blockData = learningData.find(b => b.block === appState.currentBlock);
        let allQuestions = [];
        blockData.topics.forEach(topic => {
            if (topic.quiz) {
                const topicQuestions = topic.quiz.map(q => ({...q, topicTitle: topic.title}));
                allQuestions = allQuestions.concat(topicQuestions);
            }
        });
        appState.quizContext = 'block';
        startQuiz(allQuestions, `Evaluaci√≥n Final: Bloque ${blockData.block}`);
    }
    
    function startQuiz(questions, title, isRetry = false) {
        document.getElementById('quiz-main-title').textContent = title;
        
        if (!isRetry) {
             appState.quizState = {
                questions: [...questions],
                currentQuestionIndex: 0,
                score: 0,
                totalQuestions: questions.length,
                incorrectlyAnswered: [],
                isRetry: false
            };
        }
        
        if (!questions || questions.length === 0) {
            console.error("Quiz started with no questions for:", title);
            return;
        }

        renderQuizQuestion();
        navigateTo('quiz-screen');
    }

    function renderQuizQuestion() {
        const { questions, currentQuestionIndex, totalQuestions } = appState.quizState;
        const questionData = questions[currentQuestionIndex];
        
        document.getElementById('quiz-topic-title').textContent = questionData.topicTitle || '';
        document.getElementById('quiz-progress-bar').style.width = `${((currentQuestionIndex) / totalQuestions) * 100}%`;
        
        const fullTextToRead = `${questionData.prompt}. Las opciones son: ${questionData.options.join(', ')}`;

        const questionContainer = document.getElementById('quiz-question-container');
        questionContainer.innerHTML = `<p id="quiz-question" class="text-xl md:text-3xl min-h-[80px] flex-grow">${questionData.prompt}</p>
        <button onclick="speakText(\`${fullTextToRead.replace(/`/g, "'")}\`)" class="speak-btn mb-8" aria-label="Escuchar de nuevo">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" /></svg>
        </button>`;

        const imageContainer = document.getElementById('quiz-image-container');
        imageContainer.innerHTML = questionData.image || '';
        
        const optionsContainer = document.getElementById('quiz-options');
        optionsContainer.innerHTML = '';
        questionData.options.forEach(option => {
            const optionEl = document.createElement('button');
            optionEl.className = 'quiz-option p-4 border-2 border-gray-300 rounded-lg text-lg';
            optionEl.textContent = option;
            optionEl.onclick = () => selectQuizOption(optionEl, option, questionData.answer);
            optionsContainer.appendChild(optionEl);
        });

        document.getElementById('quiz-next-btn').classList.add('hidden');

        setTimeout(() => {
            speakText(fullTextToRead);
        }, 100);
    }

    function selectQuizOption(optionEl, selectedAnswer, correctAnswer) {
        stopSpeaking();
        document.querySelectorAll('#quiz-options button').forEach(btn => {
            btn.disabled = true;
            if(btn.textContent === correctAnswer) btn.classList.add('correct');
        });

        if (selectedAnswer === correctAnswer) {
            appState.quizState.score++;
        } else {
            optionEl.classList.add('incorrect');
            const currentQuestion = appState.quizState.questions[appState.quizState.currentQuestionIndex];
            appState.quizState.incorrectlyAnswered.push(currentQuestion);
        }
        
        document.getElementById('quiz-next-btn').classList.remove('hidden');
    }

    function nextQuizQuestion() {
        appState.quizState.currentQuestionIndex++;
        const { currentQuestionIndex, totalQuestions, incorrectlyAnswered, isRetry } = appState.quizState;
        
        if (currentQuestionIndex < totalQuestions) {
            renderQuizQuestion();
        } else {
            // Quiz is over, check for retry or completion
            if (incorrectlyAnswered.length > 0 && !isRetry) {
                alert('¬°Vamos a repasar! Responde de nuevo las preguntas que se te dificultaron.');
                appState.quizState = {
                    ...appState.quizState,
                    questions: [...incorrectlyAnswered],
                    totalQuestions: incorrectlyAnswered.length,
                    currentQuestionIndex: 0,
                    incorrectlyAnswered: [],
                    score: 0,
                    isRetry: true
                };
                renderQuizQuestion();
            } else {
                // Final completion logic
                handleQuizCompletion();
            }
        }
    }

    function handleQuizCompletion() {
        const { score, totalQuestions } = appState.quizState;
        const success = appState.quizContext === 'block' ? true : (score === totalQuestions);

        if (appState.quizContext === 'lesson') {
            if (success) {
                showActivityModal();
            } else {
                alert('¬°Oh no! Necesitas responder todas las preguntas correctamente para avanzar. ¬°Int√©ntalo de nuevo m√°s tarde!');
                showBlockView(appState.currentBlock);
            }
        } else if (appState.quizContext === 'reading') {
            if (success) {
                progress.completedReadings.push(appState.currentReading.id);
                progress.lastReadingDate = new Date().toISOString().slice(0, 10);
                saveProgress();
                alert('¬°Muy bien! Has comprendido la lectura.');
                renderWelcomeScreen();
            } else {
                 alert('Parece que algunas respuestas no fueron correctas. ¬°Vamos a intentarlo de nuevo!');
                 startReadingQuiz(appState.currentReading);
            }
        } else { // 'block' context
             showResults();
        }
    }

    function showActivityModal() {
        const topic = learningData.find(b => b.block === appState.currentBlock).topics.find(t => t.id === appState.currentTopicId);
        document.getElementById('activity-modal-text').textContent = topic.activity;
        document.getElementById('activity-modal').classList.add('flex');
        document.getElementById('activity-confirm-btn').onclick = () => {
            document.getElementById('activity-modal').classList.remove('flex');
            progress.lessonsCompletedToday.count++;
            markTopicAsCompleted(appState.currentTopicId);
            checkAndUnlockNextBlock();
            showBlockView(appState.currentBlock);
        };
    }

    function showResults() {
        const { score, totalQuestions } = appState.quizState;
        const currentBlockNumber = appState.currentBlock;
        document.getElementById('results-block-name').textContent = `Bloque ${currentBlockNumber}`;
        document.getElementById('final-score').textContent = `${score}/${totalQuestions}`;
        
        const percentage = totalQuestions > 0 ? (score / totalQuestions) * 100 : 0;
        let message = '';
        if (percentage >= 80) message = '¬°Eres una superestrella del conocimiento!';
        else if (percentage >= 50) message = '¬°Buen trabajo! Sigue practicando.';
        else message = '¬°No te preocupes! Repasar es parte de aprender. ¬°T√∫ puedes!';
        document.getElementById('final-message').textContent = message;
        speakText(`¬°Excelente trabajo! Tu puntuaci√≥n final es ${score} de ${totalQuestions}. ${message}`);

        navigateTo('results-screen');
    }
    
    function showProjects() {
        const blockData = learningData.find(b => b.block === appState.currentBlock);
        if (!blockData || !blockData.project) return;
        
        document.getElementById('project-title').textContent = blockData.project.title;
        document.getElementById('project-description').textContent = blockData.project.description;
        const materialsList = document.getElementById('project-materials');
        materialsList.innerHTML = '';
        blockData.project.materials.forEach(item => {
            const li = document.createElement('li');
            li.textContent = item;
            materialsList.appendChild(li);
        });
        navigateTo('projects-screen');
    }

    // --- INIT ---
    document.addEventListener('DOMContentLoaded', () => {
        loadVoices();
        loadProgress();
        renderWelcomeScreen();
        
        document.getElementById('start-block-quiz-btn').onclick = startBlockQuiz;
        document.getElementById('quiz-next-btn').onclick = nextQuizQuestion;
        document.getElementById('show-projects-btn').onclick = showProjects;
        document.getElementById('back-to-results').onclick = showResults;

        document.getElementById('prev-step-btn').onclick = () => {
            if (appState.currentStep > 0) {
                appState.currentStep--;
                renderLessonStep();
            }
        };
    });
    </script>
</body>
</html>

